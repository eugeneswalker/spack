spack:
  include:
  - $spack/share/spack/gitlab/cloud_pipelines/configs/linux/ci.yaml

  view: false

  concretizer:
    reuse: false
    unify: false

  packages:
    all:
      require: '%cce'
      compiler: [cce]
      providers:
        blas: [cray-libsci]
        lapack: [cray-libsci]
        mpi: [cray-mpich]
        tbb: [intel-tbb]
        scalapack: [netlib-scalapack]
      target: [zen4]
      variants: +mpi

    tbb:
      require: "intel-tbb"
    binutils:
      variants: +ld +gold +headers +libiberty ~nls
    boost:
      variants: +python +filesystem +iostreams +system
    cuda:
      version: [11.7.0]
    elfutils:
      variants: +bzip2 ~nls +xz
      require: "%gcc"
    hdf5:
      variants: +fortran +hl +shared
    libfabric:
      variants: fabrics=sockets,tcp,udp,rxm
    libunwind:
      variants: +pic +xz
    mpich:
      variants: ~wrapperrpath
    ncurses:
      variants: +termlib
    paraview:
      # Don't build GUI support or GLX rendering for HPC/container deployments
      require: "@5.11 ~qt+osmesa"
    python:
      version: [3.8.13]
    trilinos:
      require:
      - one_of: [+amesos +amesos2 +anasazi +aztec +boost +epetra +epetraext +ifpack
            +intrepid +intrepid2 +isorropia +kokkos +minitensor +nox +piro +phalanx
            +rol +rythmos +sacado +stk +shards +stratimikos +tempus +tpetra
            +trilinoscouplings +zoltan]
      - one_of: [gotype=long_long, gotype=all]
      - one_of: [~ml ~muelu ~zoltan2 ~teko, +ml +muelu +zoltan2 +teko]
      - one_of: [+superlu-dist, ~superlu-dist]
      - one_of: [+shylu, ~shylu]
    xz:
      variants: +pic
    mesa:
      version: [21.3.8]
    unzip:
      require: "%gcc"
    openblas:
      require: '@0.3.20'
      variants: threads=openmp

  specs:
  # CPU
  - adios
  - alquimia
  - aml
  - arborx
  - archer
  - argobots
  - axom
  - bolt
  - bricks
  - butterflypack
  - boost +python +filesystem +iostreams +system
  - cabana
  - caliper
  - chai ~benchmarks ~tests
  - charliecloud
  - conduit
  - datatransferkit
  - dealii
  # - dyninst # requires %gcc
  - ecp-data-vis-sdk ~cuda ~rocm +adios2 +ascent +cinema +darshan +faodel +hdf5 +paraview +pnetcdf +sz +unifyfs +veloc ~visit +vtkm +zfp ^hdf5@1.14
  - exaworks
  - flecsi
  - flit
  - flux-core
  - fortrilinos
  # - gasnet # configure error: User requested --enable-ofi but I don't know how to build ofi programs for your system
  - ginkgo
  - globalarrays
  - gmp
  - gotcha
  - gptune
  - h5bench
  - hdf5-vol-async
  - hdf5-vol-cache
  - hdf5-vol-log
  - heffte +fftw
  # - hpctoolkit # dyninst requires %gcc
  - hpx max_cpu_count=512 networking=mpi
  - hypre
  - kokkos +openmp
  - kokkos-kernels +openmp
  - lammps
  - legion
  - libnrm
  - libpressio +bitgrooming +bzip2 ~cuda ~cusz +fpzip +hdf5 +libdistributed
    +lua +openmp +python +sz +sz3 +unix +zfp +json +remote +netcdf +mgard
  - libquo
  - libunwind
  - mercury
  - metall
  - mfem
  - mgard +serial +openmp +timing +unstructured ~cuda
  - mpark-variant
  - mpifileutils ~xattr
  - nccmp
  - nco
  - netlib-scalapack
  - nrm
  # - nvhpc # requires %gcc
  - omega-h
  - openmpi
  - openpmd-api
  - papi
  - papyrus
  - parsec ~cuda
  - pdt
  - petsc
  - phist
  # - plasma # %cce conflict
  - plumed
  - precice
  - pumi
  - py-h5py +mpi
  - py-h5py ~mpi
  - py-jupyterhub
  - py-libensemble +mpi +nlopt
  - py-petsc4py
  - py-warpx
  - qthreads scheduler=distrib
  - quantum-espresso
  - raja
  - scr
  - slate ~cuda
  - slepc
  - stc
  - strumpack ~slate
  - sundials
  - superlu
  - superlu-dist
  - swig
  - swig@4.0.2-fortran
  - sz3
  - tasmanian
  - tau +mpi +python
  - trilinos@13.0.1 +belos +ifpack2 +stokhos
  - turbine
  - umap
  - umpire
  - upcxx
  - variorum
  - veloc
  - wannier90
  - xyce +mpi +shared +pymi +pymi_static_tpls ^trilinos~shylu

  # - amrex # disabled temporarily pending resolution of unreproducible CI failure

  mirrors: { "mirror": "s3://spack-binaries/develop/e4s-cray-rhel" }

  cdash:
    build-group: E4S Cray
