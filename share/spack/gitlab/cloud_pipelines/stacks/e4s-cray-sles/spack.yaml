spack:
  include:
  - $spack/share/spack/gitlab/cloud_pipelines/configs/linux/ci.yaml

  view: false

  concretizer:
    reuse: false
    unify: false

  packages:
    all:
      providers:
        blas: [cray-libsci]
        lapack: [cray-libsci]
        mpi: [cray-mpich]
        tbb: [intel-tbb]
        scalapack: [netlib-scalapack]
      target: [zen4]
      variants: +mpi
    gcc-runtime:
      require: "%gcc"
    tbb:
      require: "intel-tbb"
    binutils:
      variants: +ld +gold +headers +libiberty ~nls
    boost:
      variants: +python +filesystem +iostreams +system
    cuda:
      version: [11.7.0]
    elfutils:
      variants: ~nls
      require: "%gcc"
    hdf5:
      variants: +fortran +hl +shared
    libfabric:
      variants: fabrics=sockets,tcp,udp,rxm
    libunwind:
      variants: +pic +xz
    mpich:
      variants: ~wrapperrpath
    ncurses:
      variants: +termlib
    paraview:
      # Don't build GUI support or GLX rendering for HPC/container deployments
      require: "@5.11 ~qt+osmesa"
    python:
      version: [3.8.13]
    trilinos:
      require:
      - one_of: [+amesos +amesos2 +anasazi +aztec +boost +epetra +epetraext +ifpack
            +intrepid +intrepid2 +isorropia +kokkos +minitensor +nox +piro +phalanx
            +rol +rythmos +sacado +stk +shards +stratimikos +tempus +tpetra
            +trilinoscouplings +zoltan]
      - one_of: [gotype=long_long, gotype=all]
      - one_of: [~ml ~muelu ~zoltan2 ~teko, +ml +muelu +zoltan2 +teko]
    xz:
      variants: +pic
    mesa:
      version: [21.3.8]
    unzip:
      require: "%gcc"

  definitions:
  - specs:
    - adios
    - aml
    - arborx
    - argobots
    - bolt
    - boost +python +filesystem +iostreams +system
    - butterflypack
    - cabana
    - chai ~benchmarks ~tests
    - charliecloud
    - conduit
    - datatransferkit
    - flecsi
    - flit
    - flux-core
    - fortrilinos
    - ginkgo
    - globalarrays
    - gmp
    - gotcha
    - h5bench
    - hdf5-vol-async
    - hdf5-vol-cache
    - hdf5-vol-log
    - heffte +fftw
    - hpx max_cpu_count=512 networking=mpi
    - hypre
    - kokkos +openmp
    - kokkos-kernels +openmp
    - lammps
    - legion
    - libnrm
    - libpressio +bitgrooming +bzip2 ~cuda ~cusz +fpzip +hdf5 +libdistributed +lua +openmp +python +sz +sz3 +unix +zfp +json +remote +netcdf +mgard # python: Could not find platform dependent libraries <exec_prefix>
    - libquo
    - libunwind
    - mercury
    - metall
    - mfem
    - mgard +serial +openmp +timing +unstructured ~cuda
    - mpark-variant
    - mpifileutils ~xattr
    - nccmp
    - nco
    - netlib-scalapack
    - omega-h
    - openpmd-api
    - papi
    - papyrus
    - pdt
    - petsc
    - plumed
    - precice
    - pumi
    - py-h5py +mpi
    - py-h5py ~mpi
    - py-libensemble +mpi +nlopt
    - py-petsc4py
    - qthreads scheduler=distrib
    - raja
    - slate ~cuda
    - stc
    - sundials
    - superlu
    - superlu-dist
    - swig
    - swig@4.0.2-fortran
    - sz3
    - tasmanian
    - trilinos +belos +ifpack2 +stokhos
    - turbine
    - umap
    - umpire
    - veloc
    - wannier90
    # --
    # - openmpi # pmix%cce
    # - tau +mpi +python

  - matrix:
    - [$specs]
    - ["%cce"]
    exclude:
    - butterflypack
    - mfem
    - petsc
    - plumed
    - precice
    - py-petsc4py
    - slate
    - superlu-dist

  - matrix:
    - [$specs]
    - ["%gcc"]

  cdash:
    build-group: E4S Cray SLES
